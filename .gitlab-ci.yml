stages:
  - build


  
.build-win-x64: &build-win-x64 
  variables:
    VERSION: 1.2.0+$CI_PIPELINE_IID
  image: mcr.microsoft.com/dotnet/core/sdk:3.1-alpine
  before_script:
    - apk add zip
  script: 
    - "dotnet publish -r win-x64 -c Release -o publish /p:PublishSingleFile=true"
    - "zip -j $INJECTOR_ARCHIVE LICENSE README.md CHANGELOG.md sample-config.ini publish/Injector.exe"
  artifacts:
    paths:
      - $INJECTOR_ARCHIVE

master:
  stage: build
  <<: *build-win-x64
  except:
    - tags
  variables:
    INJECTOR_ARCHIVE: injector.zip injector-$VERSION.$CI_COMMIT_REF_SLUG.zip

release:
  stage: build
  <<: *build-win-x64
  only:
    - tags
    - /^v\d+\.\d+\.\d+$/
